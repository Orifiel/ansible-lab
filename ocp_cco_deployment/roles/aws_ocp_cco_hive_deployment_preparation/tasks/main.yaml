---
- name: Get all existing Namespaces
  kubernetes.core.k8s_info:
    kind: Namespace
  register: ocp_namespaces
  delegate_to: localhost

- name: Define namespace list
  ansible.builtin.set_fact:
    ns_list: "{{ ocp_namespaces.resources }}"

- debug:
    var: ns_list[item].metadata.name
  loop: "{{ range(0, ns_list | length) | list }}" 

- name: Create cluster namespace
  kubernetes.core.k8s:
    name: "{{ ocp_cluster_name }}"
    api_version: v1
    kind: Namespace
    state: present
    validate_certs: false
  delegate_to: localhost

- name: Create secret for Hive Deployment
  kubernetes.core.k8s:
    state: present
    src: "{{ install_directory }}/{{ ocp_cluster_name }}-credentials-requests/bound-service-account-signing-key.yaml"

- name: Create Configmap for Hive Deployment
  kubernetes.core.k8s:
    state: present
    src: "{{ install_directory }}/cluster-manifests.yaml"
